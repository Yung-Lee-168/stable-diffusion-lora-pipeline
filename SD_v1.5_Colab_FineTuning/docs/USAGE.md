# 📖 使用說明

## 🚀 快速開始

### 方法 1: 使用完整訓練 Notebook（推薦）

1. **上傳到 Google Colab**
   ```
   將 notebooks/SD_v1.5_Complete_Training.ipynb 上傳到 Colab
   ```

2. **確保 GPU 已啟用**
   ```
   Runtime > Change runtime type > Hardware accelerator > GPU
   ```

3. **執行所有單元格**
   ```
   Runtime > Run all
   ```

4. **等待完成並下載結果**

### 方法 2: 分步執行

1. **環境設置**
   ```
   先執行 notebooks/Environment_Setup.ipynb
   ```

2. **快速測試**
   ```
   執行 notebooks/Quick_Test.ipynb 驗證環境
   ```

3. **完整訓練**
   ```
   執行 notebooks/SD_v1.5_Complete_Training.ipynb
   ```

## 📋 詳細使用流程

### 準備階段

1. **準備訓練圖片**
   - 數量：10-50 張高品質圖片
   - 格式：JPG 或 PNG
   - 解析度：建議 512x512 或更高
   - 內容：同一主題或風格的圖片

2. **檢查系統需求**
   - Google Colab 帳號
   - GPU 運行時（建議 Colab Pro）
   - 穩定的網路連接
   - 足夠的 Google Drive 空間

### 執行階段

#### 🔧 環境設置

1. **上傳 Environment_Setup.ipynb**
2. **執行所有單元格**
   - 會自動安裝所需依賴
   - 修復可能的套件衝突
   - 驗證安裝狀態

3. **檢查設置結果**
   - 所有必要套件應該顯示 ✅
   - GPU 應該可用
   - CUDA 應該正常工作

#### 🚀 快速測試（可選）

1. **上傳 Quick_Test.ipynb**
2. **執行測試**
   - 驗證模型載入
   - 測試基本生成
   - 檢查記憶體使用

3. **確認測試結果**
   - 所有測試應該通過
   - 系統準備就緒

#### 🎯 完整訓練

1. **上傳 SD_v1.5_Complete_Training.ipynb**
2. **按順序執行每個步驟**
   
   **步驟詳解：**
   
   - **環境檢查**：自動檢查 GPU 和依賴
   - **依賴安裝**：安裝並修復必要套件
   - **驗證安裝**：確認所有組件正常
   - **Drive 設置**：掛載 Google Drive
   - **載入腳本**：上傳主要訓練腳本
   - **上傳圖片**：上傳您的訓練圖片
   - **訓練配置**：根據 GPU 自動配置參數
   - **開始訓練**：執行微調訓練
   - **查看結果**：檢視生成的圖片和圖表
   - **打包下載**：下載完成的模型

3. **監控訓練進度**
   - 查看損失值變化
   - 檢查驗證圖片
   - 監控記憶體使用

4. **下載結果**
   - 自動打包所有結果
   - 包含模型、圖片、圖表
   - 直接下載到本地

## ⚙️ 配置選項

### 訓練參數調整

根據您的需求調整以下參數：

```python
config = {
    "num_epochs": 10,           # 訓練輪數
    "learning_rate": 1e-4,      # 學習率
    "train_batch_size": 1,      # 批次大小
    "lora_rank": 4,             # LoRA 等級
    "image_size": 512           # 圖片大小
}
```

### GPU 特定優化

系統會自動檢測您的 GPU 並應用最佳配置：

- **T4 (16GB)**：保守設置，確保穩定性
- **V100 (16GB)**：平衡性能和穩定性
- **A100 (40GB)**：最高性能設置

### 進階選項

如需自定義配置，可修改 `configs/` 目錄下的檔案：

- `training_config.yaml`：基本訓練設置
- `gpu_optimization.yaml`：GPU 優化設置
- `model_settings.yaml`：模型詳細設置

## 🔍 訓練監控

### 訓練指標

關注以下指標來判斷訓練效果：

1. **損失值（Loss）**
   - 應該逐漸下降
   - 不應該劇烈波動
   - 典型範圍：0.01-0.1

2. **驗證圖片**
   - 每 50 步生成驗證圖片
   - 觀察圖片品質改善
   - 檢查是否出現過擬合

3. **記憶體使用**
   - 監控 GPU 記憶體
   - 避免記憶體溢出
   - 適時清理緩存

### 問題診斷

**訓練太慢？**
- 檢查是否使用 GPU
- 啟用 xformers 優化
- 減少圖片大小

**記憶體不足？**
- 降低 batch_size
- 增加 gradient_accumulation_steps
- 啟用記憶體優化選項

**效果不佳？**
- 增加訓練輪數
- 調整學習率
- 檢查訓練數據品質

## 📊 結果分析

### 訓練完成後

1. **檢查最終模型**
   - 模型檔案大小
   - 訓練參數摘要
   - 最終損失值

2. **分析驗證圖片**
   - 圖片品質改善
   - 風格一致性
   - 細節表現

3. **查看訓練圖表**
   - 損失曲線
   - 學習率變化
   - 記憶體使用情況

### 模型使用

下載的模型包含：

- **LoRA 權重**：用於載入到原始 SD v1.5
- **完整模型**：可直接使用的管道
- **配置檔案**：訓練參數記錄
- **驗證圖片**：效果展示

## 🔧 故障排除

### 常見問題

1. **依賴衝突**
   ```
   重新啟動運行時並重新執行環境設置
   ```

2. **GPU 記憶體不足**
   ```
   減少 batch_size，啟用記憶體優化
   ```

3. **訓練中斷**
   ```
   檢查是否會話過期，從檢查點恢復
   ```

4. **生成效果差**
   ```
   檢查訓練數據、調整參數、增加訓練時間
   ```

### 取得幫助

如遇到問題：

1. 查看 [故障排除指南](TROUBLESHOOTING.md)
2. 檢查 [常見問題](FAQ.md)
3. 聯繫技術支援

## 💡 最佳實踐

### 訓練技巧

1. **數據準備**
   - 使用高品質圖片
   - 保持風格一致性
   - 避免過於複雜的場景

2. **參數調整**
   - 從較小的學習率開始
   - 逐步增加訓練輪數
   - 監控過擬合跡象

3. **效果評估**
   - 定期檢查驗證圖片
   - 與原始模型比較
   - 測試不同提示詞

### 性能優化

1. **使用 Colab Pro**
   - 更好的 GPU
   - 更長的運行時間
   - 更穩定的連接

2. **啟用所有優化**
   - xformers 注意力優化
   - 混合精度訓練
   - 記憶體管理

3. **合理設置參數**
   - 根據 GPU 調整批次大小
   - 使用適當的 LoRA 等級
   - 平衡訓練時間和效果

---

**版本**：v1.0.0  
**更新日期**：2025-07-04  
**支援**：適用於 Google Colab 環境
